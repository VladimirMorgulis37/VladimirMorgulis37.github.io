<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• –ë–ï–ó–£–ú–ù–´–ô –ß–ê–¢ + –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† + –î–†–ê–ì + –†–ï–í–ï–†–ë üî•</title>
    <style>
        /* === –í–ê–®–ò CSS –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô === */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh; padding: 20px; overflow: hidden;
            transition: background 0.5s;
        }
        body.party-mode {
            animation: partyBackground 0.5s infinite;
        }
        @keyframes partyBackground {
            0% { background: linear-gradient(135deg, #ff0000, #ff00ff); }
            25% { background: linear-gradient(135deg, #00ff00, #00ffff); }
            50% { background: linear-gradient(135deg, #0000ff, #ff00ff); }
            75% { background: linear-gradient(135deg, #ffff00, #ff0000); }
            100% { background: linear-gradient(135deg, #ff0000, #ff00ff); }
        }

        .connection-status {
            position: fixed; top: 20px; left: 20px; padding: 10px 20px;
            background: rgba(0,0,0,0.7); border-radius: 25px; color: white;
            font-size: 14px; z-index: 1000; display: flex; align-items: center; gap: 10px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
        }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background: #2ecc71; animation: pulse 2s infinite; }
        .status-dot.disconnected { background: #e74c3c; animation: none; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .users-panel {
            position: fixed; top: 70px; left: 20px; width: 220px;
            background: rgba(0,0,0,0.7); border-radius: 15px; color: white;
            z-index: 1000; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
            max-height: 300px; overflow-y: auto;
        }
        .users-panel h3 { padding: 15px; font-size: 16px; color: #4a90e2; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .user-list { display: flex; flex-direction: column; }
        .user-item {
            display: flex; align-items: center; gap: 10px; padding: 10px 15px;
            background: rgba(255,255,255,0.05); cursor: pointer; transition: 0.2s;
        }
        .user-item:hover { background: rgba(255,255,255,0.15); transform: translateX(5px); }
        .user-item.active { background: rgba(74,144,226,0.3); border-left: 3px solid #4a90e2; }
        .user-dot { width: 10px; height: 10px; border-radius: 50%; animation: userPulse 2s infinite; }
        @keyframes userPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .user-name { flex: 1; font-size: 13px; }
        .user-activity { font-size: 10px; color: #888; }

        .calculator {
            width: 260px; margin: 80px auto 20px; background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px); padding: 20px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2);
            position: relative; z-index: 5;
            transition: all 0.3s;
        }
        .calculator.party-mode {
            animation: calcCrazy 0.5s infinite;
        }
        @keyframes calcCrazy {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(2deg) scale(1.05); }
            50% { transform: rotate(-2deg) scale(1.1); }
            75% { transform: rotate(2deg) scale(1.05); }
            100% { transform: rotate(0deg) scale(1); }
        }

        .display {
            padding: 20px 15px; background: rgba(0,0,0,0.3); text-align: right;
            font-size: 32px; font-weight: bold; border-radius: 12px; margin-bottom: 15px;
            min-height: 70px; color: #fff; text-shadow: 0 0 10px rgba(74,144,226,0.8);
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
            word-wrap: break-word;
        }
        .display::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg); animation: shine 3s infinite; pointer-events: none;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            20%, 100% { transform: translateX(100%) rotate(45deg); }
        }

        .display.wobble { animation: crazyWobble 0.15s ease-out; }
        @keyframes crazyWobble {
            0% { transform: scale(1); filter: hue-rotate(0deg); }
            50% { transform: scale(1.2) rotate(5deg); filter: hue-rotate(180deg); }
            100% { transform: scale(1); filter: hue-rotate(0deg); }
        }

        .display.glow { animation: glowPulse 0.5s; }
        @keyframes glowPulse {
            0% { text-shadow: 0 0 10px #4a90e2; }
            50% { text-shadow: 0 0 30px #ff00ff, 0 0 50px #00ffff; }
            100% { text-shadow: 0 0 10px #4a90e2; }
        }

        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        button {
            width: 100%; height: 55px; border: none; border-radius: 12px;
            background: linear-gradient(145deg, #4a90e2, #357abd); color: white;
            font-size: 20px; cursor: pointer; transition: 0.1s;
            position: relative; overflow: hidden;
        }
        button:hover { transform: translateY(-2px) scale(1.05); filter: brightness(1.2); }
        button:active { transform: translateY(2px) scale(0.95); }
        button.operator { background: linear-gradient(145deg, #2ecc71, #27ae60); }
        button.equals { background: linear-gradient(145deg, #e74c3c, #c0392b); grid-column: span 2; }
        button.clear { background: linear-gradient(145deg, #95a5a6, #7f8c8d); grid-column: span 4; }

        .calc-history {
            position: fixed; top: 400px; left: 20px; width: 220px; max-height: 200px;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(10px);
            border-radius: 15px; padding: 10px; color: white; font-size: 12px;
            overflow-y: auto; border: 1px solid rgba(255,255,255,0.2); z-index: 100;
        }
        .calc-history h4 { color: #4a90e2; margin-bottom: 10px; }
        .history-item {
            padding: 5px; border-bottom: 1px solid rgba(255,255,255,0.1);
            animation: slideIn 0.3s; display: flex; gap: 5px; align-items: center;
        }
        .history-dot { width: 8px; height: 8px; border-radius: 50%; }

        .audio-player {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 340px; padding: 0; background: rgba(255,255,255,0.1); backdrop-filter: blur(15px);
            border-radius: 30px; box-shadow: 0 15px 60px rgba(0,0,0,0.5), 0 0 80px rgba(74,144,226,0.4);
            border: 1px solid rgba(255,255,255,0.2); z-index: 50;
            transition: box-shadow 0.1s, filter 0.1s; display: flex; flex-direction: column;
        }
        .audio-player.party-mode { animation: playerCrazy 0.3s infinite; }
        @keyframes playerCrazy {
            0% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
            100% { filter: hue-rotate(360deg); }
        }

        .player-header {
            padding: 15px 20px; background: rgba(0,0,0,0.3); border-radius: 30px 30px 0 0;
            cursor: grab; display: flex; justify-content: space-between; align-items: center; user-select: none;
        }
        .player-header:active { cursor: grabbing; }
        .player-title { font-weight: bold; color: #4a90e2; font-size: 14px; letter-spacing: 1px; }
        .drag-icon { color: rgba(255,255,255,0.5); font-size: 12px; }

        .player-content { padding: 20px; }
        canvas#osc {
            background: rgba(0,0,0,0.4); border-radius: 15px; margin: 0 0 20px;
            width: 100%; height: 120px; border: 2px solid rgba(74,144,226,0.5); pointer-events: none;
        }

        .controls { width: 100%; display: flex; flex-direction: column; gap: 15px; }
        .control-group label { font-size: 12px; color: #ccc; display: flex; justify-content: space-between; }
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; background: rgba(255,255,255,0.15); border-radius: 3px; outline: none; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
            background: #4a90e2; cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 10px rgba(74,144,226,0.8); transition: all 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); background: #ff00ff; }
        input[type="range"].is-playing::-webkit-slider-thumb { animation: rainbowPulse 1s infinite; background: #2ecc71; }
        @keyframes rainbowPulse {
            0% { box-shadow: 0 0 10px #2ecc71; transform: scale(1); }
            50% { box-shadow: 0 0 25px #ff00ff, 0 0 50px #00ffff; transform: scale(1.3); }
            100% { box-shadow: 0 0 10px #2ecc71; transform: scale(1); }
        }
        #reverb::-webkit-slider-thumb { background: linear-gradient(145deg, #9b59b6, #8e44ad); }

        .playback-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .playback-controls button {
            flex: 1; height: 40px; font-size: 14px; border-radius: 20px;
            background: linear-gradient(145deg, #6c5ce7, #a29bfe); position: relative; overflow: hidden;
        }

        .chat-widget {
            position: fixed; bottom: 20px; right: 20px; width: 350px; height: 500px;
            background: rgba(20, 20, 30, 0.95); backdrop-filter: blur(20px);
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 100; display: flex; flex-direction: column;
            overflow: hidden; transition: transform 0.3s, opacity 0.3s, height 0.3s;
        }
        .chat-widget.minimized { height: 60px; width: 200px; cursor: pointer; }
        .chat-widget.minimized .chat-messages, .chat-widget.minimized .chat-input-area { display: none; }
        .chat-widget.party-mode { animation: chatCrazy 0.5s infinite; }
        @keyframes chatCrazy {
            0% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-1deg); }
            50% { transform: translateY(0) rotate(1deg); }
            75% { transform: translateY(5px) rotate(-1deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        .chat-header {
            padding: 15px; background: rgba(74,144,226,0.2); border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        }
        .chat-tabs { display: flex; gap: 10px; margin-top: 5px; }
        .chat-tab {
            font-size: 12px; padding: 5px 10px; border-radius: 10px; background: rgba(255,255,255,0.1); cursor: pointer; color: #aaa; transition: all 0.2s;
        }
        .chat-tab.active { background: #4a90e2; color: white; animation: tabPulse 2s infinite; }

        .chat-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .message {
            max-width: 80%; padding: 8px 12px; border-radius: 12px; font-size: 13px; line-height: 1.4;
            position: relative; animation: messagePop 0.3s ease-out; transition: all 0.2s;
        }
        .message.global { align-self: flex-start; background: rgba(255,255,255,0.1); border-bottom-left-radius: 2px; border-left: 3px solid #4a90e2; }
        .message.private { align-self: flex-end; background: rgba(74,144,226,0.3); border-bottom-right-radius: 2px; border-right: 3px solid #ff00ff; }
        .message .sender { font-size: 10px; opacity: 0.7; margin-bottom: 2px; display: block; font-weight: bold; text-transform: uppercase; }
        .message .time { font-size: 9px; opacity: 0.5; float: right; margin-left: 10px; margin-top: 4px; }

        .chat-input-area { padding: 15px; background: rgba(0,0,0,0.2); display: flex; gap: 10px; }
        .chat-input-area input { flex: 1; padding: 10px; border-radius: 20px; border: none; background: rgba(255,255,255,0.1); color: white; outline: none; }
        .chat-input-area button { width: 40px; height: 40px; border-radius: 50%; border: none; background: #4a90e2; color: white; cursor: pointer; }

        .party-btn {
            position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px;
            border-radius: 50%; background: linear-gradient(145deg, #ff0080, #8000ff);
            border: none; color: white; font-size: 24px; cursor: pointer;
            box-shadow: 0 5px 30px rgba(255,0,128,0.6); z-index: 90; animation: partyBtnPulse 1.5s infinite; transition: all 0.3s;
        }
        .party-btn:hover { transform: scale(1.2) rotate(180deg); }
        @keyframes partyBtnPulse {
            0% { box-shadow: 0 5px 30px rgba(255,0,128,0.6); }
            50% { box-shadow: 0 5px 60px rgba(128,0,255,0.9), 0 5px 90px rgba(0,255,255,0.9); }
            100% { box-shadow: 0 5px 30px rgba(255,0,128,0.6); }
        }

        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .particle {
            position: absolute; width: 4px; height: 4px; background: #4a90e2; border-radius: 50%; animation: floatParticle 3s infinite; opacity: 0;
        }
        .particle.party { width: 10px; height: 10px; animation: partyParticle 2s infinite; }
        @keyframes partyParticle {
            0% { transform: translateY(100vh) scale(1); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(-100px) scale(3); opacity: 0; }
        }
        @keyframes floatParticle {
            0% { transform: translateY(100vh); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
        .notification {
            position: fixed; top: 20px; right: 20px; padding: 10px 20px;
            background: rgba(0,0,0,0.8); border-radius: 10px; color: white;
            font-size: 13px; z-index: 2000; animation: notificationSlide 0.3s; border-left: 4px solid #4a90e2; backdrop-filter: blur(10px);
        }
        @keyframes notificationSlide { 0% { transform: translateX(100px); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }

        .button-press-effect {
            position: fixed; width: 50px; height: 50px; border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
            pointer-events: none; animation: pressRipple 0.5s ease-out; z-index: 9999;
        }
        @keyframes pressRipple { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }
    </style>
</head>
<body>

    <div class="particles" id="particles"></div>

    <div class="connection-status">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Github Pages (–õ–æ–∫–∞–ª—å–Ω–æ)</span>
        <span id="userCount">(1)</span>
    </div>

    <div class="users-panel">
        <h3>üë• –û–Ω–ª–∞–π–Ω <span id="onlineCount">1</span></h3>
        <div class="user-list" id="userList">
            <!-- –õ–æ–∫–∞–ª—å–Ω—ã–π —é–∑–µ—Ä -->
            <div class="user-item active">
                <div class="user-dot" style="background:#2ecc71;"></div>
                <div class="user-name">–í—ã</div>
                <div class="user-activity">–æ–Ω–ª–∞–π–Ω</div>
            </div>
        </div>
    </div>

    <div class="calc-history" id="calcHistory">
        <h4>üìù –ò—Å—Ç–æ—Ä–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π</h4>
        <div id="historyList"></div>
    </div>

    <div class="calculator" id="calculator">
        <div class="display" id="display" data-text="0">0</div>
        <div class="buttons">
            <button onclick="sendInput('7')" class="calc-btn">7</button>
            <button onclick="sendInput('8')" class="calc-btn">8</button>
            <button onclick="sendInput('9')" class="calc-btn">9</button>
            <button class="operator calc-btn" onclick="sendInput('/')">√∑</button>
            <button onclick="sendInput('4')" class="calc-btn">4</button>
            <button onclick="sendInput('5')" class="calc-btn">5</button>
            <button onclick="sendInput('6')" class="calc-btn">6</button>
            <button class="operator calc-btn" onclick="sendInput('*')">√ó</button>
            <button onclick="sendInput('1')" class="calc-btn">1</button>
            <button onclick="sendInput('2')" class="calc-btn">2</button>
            <button onclick="sendInput('3')" class="calc-btn">3</button>
            <button class="operator calc-btn" onclick="sendInput('-')">‚àí</button>
            <button onclick="sendInput('0')" class="calc-btn">0</button>
            <button onclick="sendInput('.')" class="calc-btn">.</button>
            <button class="equals calc-btn" onclick="calculate()">=</button>
            <button class="operator calc-btn" onclick="sendInput('+')">+</button>
            <button class="clear calc-btn" onclick="clearAll()" style="grid-column: span 4;">üóë CLEAR</button>
        </div>
    </div>

    <div class="audio-player" id="playerContainer">
        <div class="player-header" id="playerHeader">
            <span class="player-title">üéµ MEGA PLAYER + REVERB</span>
            <span class="drag-icon">‚†ø‚†ø‚†ø</span>
        </div>

        <div class="player-content">
            <canvas id="osc" width="320" height="120"></canvas>
            <div class="playback-controls">
                <button id="playBtn">üîä PLAY</button>
                <button id="pauseBtn">‚è∏ PAUSE</button>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>‚è± –ü—Ä–æ–≥—Ä–µ—Å—Å <span id="progressValue">0%</span></label>
                    <input type="range" id="progress" min="0" max="100" value="0" step="0.1">
                </div>
                <div class="control-group">
                    <label>üîà –ì—Ä–æ–º–∫–æ—Å—Ç—å <span id="volumeValue">50%</span></label>
                    <input type="range" id="volume" min="0" max="100" value="50">
                </div>
                <div class="control-group">
                    <label>‚ö° –°–∫–æ—Ä–æ—Å—Ç—å <span id="speedValue">1.0x</span></label>
                    <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1">
                </div>
                <div class="control-group">
                    <label>üéµ –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å <span id="pitchValue">0</span></label>
                    <input type="range" id="pitch" min="-1200" max="1200" step="100" value="0">
                </div>
                <div class="control-group">
                    <label>üåÄ –†–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—è <span id="reverbValue">0%</span></label>
                    <input type="range" id="reverb" min="0" max="100" value="0">
                </div>
            </div>
        </div>
    </div>

    <div class="chat-widget" id="chatWidget">
        <div class="chat-header" onclick="toggleChat()">
            <div>
                <strong>üí¨ –ß–∞—Ç</strong>
                <div class="chat-tabs">
                    <span class="chat-tab active" id="tabGlobal" onclick="switchChatTab('global', event)">–û–±—â–∏–π</span>
                </div>
            </div>
            <span style="font-size: 20px;">‚àí</span>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div style="text-align:center; opacity:0.5; font-size:12px; margin-top:10px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—á–∞—Ç!</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleChatKey(event)">
            <button onclick="sendChatMessage()">‚û§</button>
        </div>
    </div>

    <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ü–£–¢–¨ –ö –ú–£–ó–´–ö–ï: public/music.mp3 -->
    <audio id="myTrack" src="public/music.mp3" crossorigin="anonymous"></audio>
    <button class="party-btn" id="partyBtn" title="–†–ï–ñ–ò–ú –í–ï–ß–ï–†–ò–ù–ö–ò!">üéâ</button>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–ë–µ–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤, —á–∏—Å—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π JS)
        const display = document.getElementById("display");
        const audio = document.getElementById('myTrack');
        const playerContainer = document.getElementById('playerContainer');
        const playerHeader = document.getElementById('playerHeader');
        const canvas = document.getElementById('osc');
        const canvasCtx = canvas.getContext('2d');
        const chatWidget = document.getElementById('chatWidget');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const historyList = document.getElementById('historyList');
        const calculator = document.getElementById('calculator');

        let audioContext, analyser, source, dataArray;
        let reverbNode, wetGain, dryGain;
        let hue = 0, isPartyMode = false;
        let currentChatTab = 'global';
        let calcHistory =[];
        const MAX_HISTORY = 20;

        audio.preservesPitch = false;

        // === DRAG AND DROP ===
        let isDragging = false;
        let dragOffsetX = 0, dragOffsetY = 0;

        playerHeader.addEventListener('mousedown', (e) => {
            isDragging = true;
            const rect = playerContainer.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;

            playerContainer.style.transform = 'none';
            playerContainer.style.left = rect.left + 'px';
            playerContainer.style.top = rect.top + 'px';
            playerContainer.style.zIndex = 1000;
            playerContainer.style.transition = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            let newX = Math.max(0, Math.min(e.clientX - dragOffsetX, window.innerWidth - playerContainer.offsetWidth));
            let newY = Math.max(0, Math.min(e.clientY - dragOffsetY, window.innerHeight - playerContainer.offsetHeight));
            playerContainer.style.left = newX + 'px';
            playerContainer.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                playerContainer.style.zIndex = 50;
                playerContainer.style.transition = 'box-shadow 0.1s, filter 0.1s';
            }
        });

        // === –ß–ê–¢ –õ–û–ì–ò–ö–ê (–õ–û–ö–ê–õ–¨–ù–ê–Ø) ===
        function toggleChat() { chatWidget.classList.toggle('minimized'); }
        function switchChatTab(tab, event) {
            event.stopPropagation();
            currentChatTab = tab;
        }

        function handleChatKey(e) { if (e.key === 'Enter') sendChatMessage(); }

        function sendChatMessage() {
            const text = chatInput.value.trim();
            if (!text) return;
            addMessageToChat({
                name: '–í—ã',
                color: '#2ecc71',
                message: text,
                timestamp: Date.now()
            }, 'global');
            chatInput.value = '';
        }

        function addMessageToChat(data, type) {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            const time = new Date(data.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            div.innerHTML = `
                <span class="sender" style="color: ${data.color}">${data.name}</span>
                ${data.message}
                <span class="time">${time}</span>
            `;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            div.style.animation = 'none';
            div.offsetHeight;
            div.style.animation = 'messagePop 0.3s ease-out';
        }

        // === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –õ–û–ì–ò–ö–ê (–õ–û–ö–ê–õ–¨–ù–ê–Ø) ===
        function sendInput(value) {
            if (display.textContent === '0' && value !== '.') display.textContent = value;
            else display.textContent += value;
            createPressEffect(event);
            triggerEffect();
        }

        function calculate() {
            try {
                const cleanExpr = display.textContent.replace(/[^0-9+\-*/.]/g, '');
                const result = String(Function('"use strict";return (' + cleanExpr + ')')());
                addToHistory(display.textContent, result, '–í—ã', '#2ecc71');
                display.textContent = result;
                
                display.classList.add('glow');
                setTimeout(() => display.classList.remove('glow'), 500);

                if (result === '42' || result === '1337' || result.includes('0')) {
                    for (let i = 0; i < 20; i++) setTimeout(() => createParticle(true), i * 50);
                }
            } catch (e) { display.textContent = 'Error'; }
            createPressEffect(event);
            triggerEffect(true);
        }

        function clearAll() {
            display.textContent = '0';
            createPressEffect(event);
            triggerEffect();
        }

        function addToHistory(expression, result, userName, userColor) {
            calcHistory.unshift({ expression, result, userName, userColor, timestamp: Date.now() });
            if (calcHistory.length > MAX_HISTORY) calcHistory.pop();
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            calcHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="history-dot" style="background: ${item.userColor}"></div>
                    <div style="flex:1">
                        <span style="color: ${item.userColor}">${item.userName}:</span>
                        ${item.expression} = <strong>${item.result}</strong>
                    </div>
                `;
                historyList.appendChild(div);
            });
        }

        function createPressEffect(e) {
            if (!e) return;
            const effect = document.createElement('div');
            effect.className = 'button-press-effect';
            effect.style.left = (e.clientX - 25) + 'px';
            effect.style.top = (e.clientY - 25) + 'px';
            effect.style.background = `radial-gradient(circle, hsl(${Math.random() * 360}, 100%, 70%) 0%, transparent 70%)`;
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 500);
        }

        // === –ê–£–î–ò–û –ö–û–ù–¢–ï–ö–°–¢ ===
        async function initAudioContext() {
            if (audioContext) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 2048;

            source = audioContext.createMediaElementSource(audio);
            dryGain = audioContext.createGain();
            wetGain = audioContext.createGain();
            reverbNode = audioContext.createConvolver();

            const sampleRate = audioContext.sampleRate;
            const length = sampleRate * 2; 
            const impulse = audioContext.createBuffer(2, length, sampleRate);

            for (let channel = 0; channel < 2; channel++) {
                const channelData = impulse.getChannelData(channel);
                for (let i = 0; i < length; i++) {
                    const decay = Math.exp(-i / (sampleRate * 0.5));
                    channelData[i] = (Math.random() * 2 - 1) * decay;
                }
            }

            reverbNode.buffer = impulse;
            source.connect(dryGain);
            source.connect(reverbNode);
            reverbNode.connect(wetGain);
            dryGain.connect(analyser);
            wetGain.connect(analyser);
            analyser.connect(audioContext.destination);

            dryGain.gain.value = 1;
            wetGain.gain.value = 0;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            
            drawOscilloscope();
            animatePulse();
        }

        // === –ê–£–î–ò–û –ö–û–ù–¢–†–û–õ–õ–´ ===
        document.getElementById('playBtn').onclick = async (event) => {
            await initAudioContext();
            audio.play().catch(e => showNotification('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ music.mp3'));
            createPressEffect(event);
        };

        document.getElementById('pauseBtn').onclick = (event) => {
            audio.pause();
            createPressEffect(event);
        };

        document.getElementById('progress').oninput = (e) => {
            const val = parseFloat(e.target.value);
            audio.currentTime = (val / 100) * audio.duration;
            document.getElementById('progressValue').textContent = val + '%';
        };

        document.getElementById('volume').oninput = (e) => {
            const val = parseFloat(e.target.value);
            audio.volume = val / 100;
            document.getElementById('volumeValue').textContent = val + '%';
        };

        document.getElementById('speed').oninput = (e) => {
            const val = parseFloat(e.target.value);
            audio.playbackRate = val;
            document.getElementById('speedValue').textContent = val + 'x';
        };

        document.getElementById('pitch').oninput = (e) => {
            const val = parseFloat(e.target.value);
            if(source) source.detune.value = val;
            document.getElementById('pitchValue').textContent = val;
        };

        document.getElementById('reverb').oninput = (e) => {
            const val = parseFloat(e.target.value) / 100;
            if (dryGain && wetGain) {
                dryGain.gain.value = 1 - val;
                wetGain.gain.value = val;
            }
            document.getElementById('reverbValue').textContent = Math.round(val * 100) + '%';
        };

        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progress').value = percent;
                document.getElementById('progressValue').textContent = Math.round(percent) + '%';
            }
        });

        // === –†–ï–ñ–ò–ú –í–ï–ß–ï–†–ò–ù–ö–ò ===
        document.getElementById('partyBtn').onclick = (event) => {
            isPartyMode = !isPartyMode;
            if (isPartyMode) {
                document.body.classList.add('party-mode');
                calculator.classList.add('party-mode');
                playerContainer.classList.add('party-mode');
                chatWidget.classList.add('party-mode');
                showNotification(`üéâ –†–ï–ñ–ò–ú –í–ï–ß–ï–†–ò–ù–ö–ò –í–´–ö–†–£–ß–ï–ù –ù–ê –ú–ê–ö–°–ò–ú–£–ú! üéâ`);
                for (let i = 0; i < 50; i++) setTimeout(() => createParticle(true), i * 20);
            } else {
                document.body.classList.remove('party-mode');
                calculator.classList.remove('party-mode');
                playerContainer.classList.remove('party-mode');
                chatWidget.classList.remove('party-mode');
            }
            createPressEffect(event);
        };

        function showNotification(text) {
            const n = document.createElement('div');
            n.className = 'notification';
            n.textContent = text;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 3000);
        }

        // === –ß–ê–°–¢–ò–¶–´ ===
        function createParticle(isParty = false) {
            const p = document.createElement('div');
            p.className = 'particle' + (isParty ? ' party' : '');
            p.style.left = Math.random() * 100 + 'vw';
            p.style.background = `hsl(${Math.random() * 360}, 100%, 60%)`;
            p.style.animationDuration = (1 + Math.random() * 3) + 's';
            p.style.width = isParty ? (5 + Math.random() * 10) + 'px' : '4px';
            p.style.height = isParty ? (5 + Math.random() * 10) + 'px' : '4px';
            document.getElementById('particles').appendChild(p);
            setTimeout(() => p.remove(), 5000);
        }

        setInterval(() => createParticle(isPartyMode), 200);

        function triggerEffect(isResult = false) {
            display.classList.remove('wobble');
            void display.offsetWidth;
            display.classList.add('wobble');
            if (isResult && isPartyMode) {
                for (let i = 0; i < 5; i++) setTimeout(() => createParticle(true), i * 100);
            }
        }

        // === –û–°–¶–ò–õ–õ–û–°–ö–û–ü –ò –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø ===
        function drawOscilloscope() {
            if (!analyser) return;
            requestAnimationFrame(drawOscilloscope);
            const timeDataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteTimeDomainData(timeDataArray);
            canvasCtx.fillStyle = 'rgba(0,0,0,0.4)';
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
            canvasCtx.lineWidth = 2;
            canvasCtx.strokeStyle = `hsl(${hue}, 100%, 70%)`;
            canvasCtx.beginPath();
            const sliceWidth = canvas.width / analyser.frequencyBinCount;
            let x = 0;
            for (let i = 0; i < analyser.frequencyBinCount; i++) {
                const v = timeDataArray[i] / 128.0;
                const y = (v * canvas.height) / 2;
                if (i === 0) canvasCtx.moveTo(x, y);
                else canvasCtx.lineTo(x, y);
                x += sliceWidth;
            }
            canvasCtx.stroke();
            hue = (hue + 1) % 360;
        }

        function animatePulse() {
            if (!analyser) return;
            requestAnimationFrame(animatePulse);
            if (audio.paused) {
                playerContainer.style.boxShadow = '0 15px 60px rgba(0,0,0,0.5)';
                playerContainer.style.filter = 'none';
                return;
            }
            analyser.getByteFrequencyData(dataArray);
            const bass = dataArray.slice(0, 10).reduce((a,b) => a + b, 0) / 10;
            const power = Math.max(0, bass - 150);

            if (isPartyMode) {
                playerContainer.style.boxShadow = `0 15px 60px rgba(0,0,0,0.5), 0 0 ${50+power}px hsl(${hue}, 100%, 50%)`;
            } else {
                playerContainer.style.boxShadow = `0 15px 60px rgba(0,0,0,0.5), 0 0 ${50+power}px rgba(74,144,226,0.5)`;
            }

            if (wetGain && wetGain.gain.value > 0.1) {
                const reverbGlow = wetGain.gain.value * 50;
                playerContainer.style.filter = `blur(${reverbGlow * 0.1}px)`;
            } else {
                playerContainer.style.filter = 'none';
            }
            document.querySelectorAll('input[type="range"]').forEach(s => s.classList.toggle('is-playing', power > 20));
        }

        document.querySelectorAll('.calc-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (isPartyMode) {
                    btn.style.transform = `rotate(${Math.random() * 20 - 10}deg) scale(1.2)`;
                    setTimeout(() => btn.style.transform = '', 200);
                    btn.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    setTimeout(() => btn.style.background = '', 300);
                }
            });
        });

        console.log('üî• –û–§–§–õ–ê–ô–ù-–í–ï–†–°–ò–Ø –î–õ–Ø GITHUB PAGES –ó–ê–ü–£–©–ï–ù–ê!');
    </script>
</body>
</html>
